# Настройка DNS - сервера

Задача:
1. Сервер должен обслуживать зону champ.first.
2. Сопоставление имен организовать в соответствии с таблицей "DNS - имена".
3. Запросы, которые выходят за рамки зоны champ.first, должны пересылаться DNS-серверу провайдера. Для проверки используйте доменное имя ya.ru.
4. Реализуйте поддержку разрешения обратной зоны.


### Настройка локального DNS - сервера
1. Обновим пакеты и установим пакет "bind":

``` bash
apt-get update && apt-get install -y haveged
```

``` bash
apt-get update && apt-get install bind -y
```

2. Редактируем конфигурационный файл по пути **"/var/lib/bind/etc/options.conf"**:

``` bash
nano /var/lib/bind/etc/options.conf
```

>[!ПРИМЕЧАНИЕ] 
>listen-on { any; };: Этот параметр определяет адреса и порты, на которых DNS-сервер будет слушать запросы. Значение any означает, что сервер будет прослушивать запросы на всех доступных интерфейсах и IP-адресах.

>recursion yes;: Устанавливает, разрешено ли серверу делать рекурсивные запросы. Рекурсивные запросы возникают, когда DNS-сервер запрашивает другие серверы и выполняет несколько итераций поиска до тех пор, пока не получит окончательный ответ.

>allow-query { any; };: Определяет список IP-адресов или подсетей, которым разрешено отправлять запросы на этот DNS-сервер. Значение any позволяет принимать запросы от всех клиентов.

>forwarders { 77.88.8.8; };: Этот параметр используется для настройки сервера DNS в режим "пересылки" (forwarding). Когда сервер получает запрос на имя, которое он не может разрешить (не имеет информации в своих зонах), он может перенаправить запрос на другой DNS-сервер (forwarder), указанный в этой директиве.

3. При помощи утилиты **"named-checkconf"** проверяем наличие ошибок в конфигурационном файле, если результат выполнения данной команды пуст - значит ошибок нет.

4. Выполняем запуск и добавление в автозагрузку DNS - сервера:

``` bash
systemctl enable --now bind
```

5. Правим конфигурационный файл "/etc/resolv.conf":

``` bash
cat <<EOF > /etc/resolv.conf
search champ.first
nameserver 127.0.0.1
EOF
``` 

Проверяем доступ до "ya.ru".


### Создание зоны прямого просмотра и добавление записей различного типа
1. Редактируем конфигурационный файл по пути **"/var/lib/bind/etc/local.conf"** отвечающий за настройку информации о зонах:

``` bash
nano /var/lib/bind/etc/local.conf
```

>[!NOTE]
>zone "champ.first" { ... };: Это начало определения зоны "champ.first". В кавычках указывается имя зоны, которое следует разрешать на этом сервере.

>type master;: Это указывает тип зоны. "type master" означает, что эта зона является мастер-зоной, то есть она содержит авторитетные записи, которые могут быть изменены и обновлены на этом сервере.

>file "champ.db";: Это указывает путь к файлу, который содержит данные зоны "champ.first". Файлы данных зоны используются для хранения записей DNS, таких как A-записи, CNAME-записи, MX-записи и т. д.

2. Скопировать пример прямой зоны:

``` bash
cp /var/lib/bind/etc/zone/{localdomain,champ.db}
```

3. Выдать права:

``` bash
chown named. /var/lib/bind/etc/zone/champ.db
chmod 600 /var/lib/bind/etc/zone/champ.db
```

4. Настраиваем зону прямого просмотра:

``` bash
nano /var/lib/bind/etc/zone/champ.db
```

>[!NOTE]
>Запись типа NS определяет авторитетные DNS-серверы для определенной зоны.

>Запись типа A связывает доменное имя с IPv4-адресом. Она используется для преобразования доменного имени в соответствующий IP-адрес.

>Запись типа CNAME используется для создания псевдонима (алиаса) для другого доменного имени. Она указывает, что одно доменное имя является псевдонимом (алиасом) для другого "канонического" доменного имени.

5. Утилитой **"named-checkconf"** с ключём "-z" проверяем что файл зоны "champ.first" не содержит ошибок и загружается:

``` bash
named-checkconf -z
```

6. Перезагружаем DNS - сервер:

``` bash
systemctl restart bind
```

Проверяем:

``` bash
host <ИМЯ>
```

>[!NOTE]
Утилиты "host" и "nslookup" в Альт Линукс входят в пакет "bind-utils"


### Создание зоны обратного просмотра и добавление PTR записей
1. Редактируем конфигурационный файл по пути **"/var/lib/bind/etc/local.conf"** отвечающий за настройку информации о зонах:

``` bash
nano /var/lib/bind/etc/local.conf
```

2. Скопировать пример зоны обратного просмотра:

``` bash
cp /var/lib/bind/etc/zone/{127.in-addr.arpa,10.db}
cp /var/lib/bind/etc/zone/{127.in-addr.arpa,20.db}
```

3. Выдать права:

``` bash
chown named. /var/lib/bind/etc/zone/{10,20}.db
chmod 600 /var/lib/bind/etc/zone/{10,20}.db
```

4. Настраиваем зону обратного просмотра "10.db":

``` bash
nano /var/lib/bind/etc/zone/10.db
```

5. Настраиваем зону обратного просмотра "20.db":

``` bash
nano /var/lib/bind/etc/zone/20.db
```

6. Проверяем утилитой named-checkconf:

``` bash
named-checkconf -z
```

7. Перезагружаем DNS - сервер:

``` bash
systemctl restart bind
```

Проверяем:

``` bash
host <IP - адрес>
```